/*
 * Assets - Deadlock API
 *
 *  ## API Clients  We have auto generated and updated clients for many languages. You can find them here: [https://github.com/deadlock-api/openapi-clients](https://github.com/deadlock-api/openapi-clients)  ## Support the Deadlock API  Whether you're building your own database, developing data science projects, or enhancing your website with game and player analytics, the Deadlock API has the data you need.  Your sponsorship helps keep this resource open, free and future-proof for everyone. By supporting the Deadlock API, you will enable continued development, new features and reliable access for developers, analysts and streamers worldwide.  Help us continue to provide the data you need - sponsor the Deadlock API today!  **-> You can Sponsor the Deadlock API on [Patreon](https://www.patreon.com/c/user?u=68961896) or [GitHub](https://github.com/sponsors/raimannma)**  ## Disclaimer _deadlock-api.com is not endorsed by Valve and does not reflect the views or opinions of Valve or anyone officially involved in producing or managing Valve properties. Valve and all associated properties are trademarks or registered trademarks of Valve Corporation_ 
 *
 * The version of the OpenAPI document: 0.1.0
 * Generated by: https://github.com/openapitools/openapi-generator.git
 */

#nullable enable

using System;
using System.Collections.Generic;
using System.Linq;
using System.Text.Json;
using System.Text.Json.Serialization;
using System.Net.Http;
using Microsoft.Extensions.DependencyInjection;
using AssetsDeadlockApiClient.Api;
using AssetsDeadlockApiClient.Model;

namespace AssetsDeadlockApiClient.Client
{
    /// <summary>
    /// Provides hosting configuration for AssetsDeadlockApiClient
    /// </summary>
    public class HostConfiguration
    {
        private readonly IServiceCollection _services;
        private readonly JsonSerializerOptions _jsonOptions = new JsonSerializerOptions();

        internal bool HttpClientsAdded { get; private set; }

        /// <summary>
        /// Instantiates the class 
        /// </summary>
        /// <param name="services"></param>
        public HostConfiguration(IServiceCollection services)
        {
            _services = services;
            _jsonOptions.Converters.Add(new JsonStringEnumConverter());
            _jsonOptions.Converters.Add(new DateTimeJsonConverter());
            _jsonOptions.Converters.Add(new DateTimeNullableJsonConverter());
            _jsonOptions.Converters.Add(new DateOnlyJsonConverter());
            _jsonOptions.Converters.Add(new DateOnlyNullableJsonConverter());
            _jsonOptions.Converters.Add(new AbilityDescriptionV2JsonConverter());
            _jsonOptions.Converters.Add(new AbilityTooltipDetailsInfoSectionPropertyBlockV2JsonConverter());
            _jsonOptions.Converters.Add(new AbilityTooltipDetailsInfoSectionV2JsonConverter());
            _jsonOptions.Converters.Add(new AbilityTooltipDetailsV2JsonConverter());
            _jsonOptions.Converters.Add(new AbilityTypeV2JsonConverter());
            _jsonOptions.Converters.Add(new AbilityTypeV2NullableJsonConverter());
            _jsonOptions.Converters.Add(new AbilityV2JsonConverter());
            _jsonOptions.Converters.Add(new AbilityV2TooltipDetailsInfoSectionPropertyBlockPropertyJsonConverter());
            _jsonOptions.Converters.Add(new AbilityVideosV2JsonConverter());
            _jsonOptions.Converters.Add(new AccoladeV2JsonConverter());
            _jsonOptions.Converters.Add(new AimingShotSpreadPenaltyJsonConverter());
            _jsonOptions.Converters.Add(new BonusJsonConverter());
            _jsonOptions.Converters.Add(new BuildTagV2JsonConverter());
            _jsonOptions.Converters.Add(new BulletResistModifierJsonConverter());
            _jsonOptions.Converters.Add(new ColorV1JsonConverter());
            _jsonOptions.Converters.Add(new CurveJsonConverter());
            _jsonOptions.Converters.Add(new DamageFlashV2JsonConverter());
            _jsonOptions.Converters.Add(new DeadlockAssetsApiRoutesValidClientVersionsJsonConverter());
            _jsonOptions.Converters.Add(new DeadlockAssetsApiRoutesValidClientVersionsNullableJsonConverter());
            _jsonOptions.Converters.Add(new EmpoweredModifierLevelJsonConverter());
            _jsonOptions.Converters.Add(new ExpirationDurationJsonConverter());
            _jsonOptions.Converters.Add(new FlashDataV2JsonConverter());
            _jsonOptions.Converters.Add(new GameModeJsonConverter());
            _jsonOptions.Converters.Add(new GameModeNullableJsonConverter());
            _jsonOptions.Converters.Add(new GenericDataV2JsonConverter());
            _jsonOptions.Converters.Add(new GlitchSettingsV2JsonConverter());
            _jsonOptions.Converters.Add(new HTTPValidationErrorJsonConverter());
            _jsonOptions.Converters.Add(new HeroColorsV2JsonConverter());
            _jsonOptions.Converters.Add(new HeroDescriptionV2JsonConverter());
            _jsonOptions.Converters.Add(new HeroImagesV2JsonConverter());
            _jsonOptions.Converters.Add(new HeroItemTypeV2JsonConverter());
            _jsonOptions.Converters.Add(new HeroItemTypeV2NullableJsonConverter());
            _jsonOptions.Converters.Add(new HeroLevelInfoV2JsonConverter());
            _jsonOptions.Converters.Add(new HeroPhysicsV2JsonConverter());
            _jsonOptions.Converters.Add(new HeroShopStatDisplayV2JsonConverter());
            _jsonOptions.Converters.Add(new HeroShopWeaponStatsDisplayV2JsonConverter());
            _jsonOptions.Converters.Add(new HeroStartingStatV2JsonConverter());
            _jsonOptions.Converters.Add(new HeroStartingStatsV2JsonConverter());
            _jsonOptions.Converters.Add(new HeroTypeV2JsonConverter());
            _jsonOptions.Converters.Add(new HeroTypeV2NullableJsonConverter());
            _jsonOptions.Converters.Add(new HeroV2JsonConverter());
            _jsonOptions.Converters.Add(new IntrinsicModifiersJsonConverter());
            _jsonOptions.Converters.Add(new ItemDraftRoundJsonConverter());
            _jsonOptions.Converters.Add(new ItemDraftRoundPerGameRoundJsonConverter());
            _jsonOptions.Converters.Add(new ItemGroupJsonConverter());
            _jsonOptions.Converters.Add(new ItemPropertyV2JsonConverter());
            _jsonOptions.Converters.Add(new ItemSlotTypeV2JsonConverter());
            _jsonOptions.Converters.Add(new ItemSlotTypeV2NullableJsonConverter());
            _jsonOptions.Converters.Add(new ItemTierV2JsonConverter());
            _jsonOptions.Converters.Add(new ItemTierV2NullableJsonConverter());
            _jsonOptions.Converters.Add(new ItemTypeV2JsonConverter());
            _jsonOptions.Converters.Add(new ItemTypeV2NullableJsonConverter());
            _jsonOptions.Converters.Add(new LaneInfoV2JsonConverter());
            _jsonOptions.Converters.Add(new LanguageJsonConverter());
            _jsonOptions.Converters.Add(new LanguageNullableJsonConverter());
            _jsonOptions.Converters.Add(new LocationInnerJsonConverter());
            _jsonOptions.Converters.Add(new LootTableV2JsonConverter());
            _jsonOptions.Converters.Add(new LootTableV2EntryJsonConverter());
            _jsonOptions.Converters.Add(new MapImagesV1JsonConverter());
            _jsonOptions.Converters.Add(new MapV1JsonConverter());
            _jsonOptions.Converters.Add(new MiniMapOffsetsJsonConverter());
            _jsonOptions.Converters.Add(new MiscV2JsonConverter());
            _jsonOptions.Converters.Add(new ModifierDefinitionJsonConverter());
            _jsonOptions.Converters.Add(new ModifierValueJsonConverter());
            _jsonOptions.Converters.Add(new NPCUnitV2JsonConverter());
            _jsonOptions.Converters.Add(new NewPlayerMetricsV2JsonConverter());
            _jsonOptions.Converters.Add(new ObjectiveHealthGrowthPhaseJsonConverter());
            _jsonOptions.Converters.Add(new ObjectiveParamsJsonConverter());
            _jsonOptions.Converters.Add(new ObjectivePositionV1JsonConverter());
            _jsonOptions.Converters.Add(new ObjectivePositionsV1JsonConverter());
            _jsonOptions.Converters.Add(new ObjectiveRegenJsonConverter());
            _jsonOptions.Converters.Add(new OutcomeToWeightsJsonConverter());
            _jsonOptions.Converters.Add(new PickupDefinitionJsonConverter());
            _jsonOptions.Converters.Add(new PickupRadiusJsonConverter());
            _jsonOptions.Converters.Add(new RangeJsonConverter());
            _jsonOptions.Converters.Add(new RangedArmorModifierJsonConverter());
            _jsonOptions.Converters.Add(new RankImagesV2JsonConverter());
            _jsonOptions.Converters.Add(new RankV2JsonConverter());
            _jsonOptions.Converters.Add(new RawAbilityActivationV2JsonConverter());
            _jsonOptions.Converters.Add(new RawAbilityActivationV2NullableJsonConverter());
            _jsonOptions.Converters.Add(new RawAbilityImbueV2JsonConverter());
            _jsonOptions.Converters.Add(new RawAbilityImbueV2NullableJsonConverter());
            _jsonOptions.Converters.Add(new RawAbilitySectionTypeV2JsonConverter());
            _jsonOptions.Converters.Add(new RawAbilitySectionTypeV2NullableJsonConverter());
            _jsonOptions.Converters.Add(new RawAbilityUpgradePropertyUpgradeV2JsonConverter());
            _jsonOptions.Converters.Add(new RawAbilityUpgradeV2JsonConverter());
            _jsonOptions.Converters.Add(new RawAbilityV2JsonConverter());
            _jsonOptions.Converters.Add(new RawAbilityV2TooltipDetailsJsonConverter());
            _jsonOptions.Converters.Add(new RawAbilityV2TooltipDetailsInfoSectionJsonConverter());
            _jsonOptions.Converters.Add(new RawAbilityV2TooltipDetailsInfoSectionPropertyBlockJsonConverter());
            _jsonOptions.Converters.Add(new RawAbilityV2TooltipDetailsInfoSectionPropertyBlockPropertyJsonConverter());
            _jsonOptions.Converters.Add(new RawAccoladeV2JsonConverter());
            _jsonOptions.Converters.Add(new RawHeroItemSlotInfoValueV2JsonConverter());
            _jsonOptions.Converters.Add(new RawHeroLevelInfoV2JsonConverter());
            _jsonOptions.Converters.Add(new RawHeroMapModCostBonusesV2JsonConverter());
            _jsonOptions.Converters.Add(new RawHeroPurchaseBonusV2JsonConverter());
            _jsonOptions.Converters.Add(new RawHeroScalingStatV2JsonConverter());
            _jsonOptions.Converters.Add(new RawHeroShopSpiritStatsDisplayV2JsonConverter());
            _jsonOptions.Converters.Add(new RawHeroShopStatDisplayV2JsonConverter());
            _jsonOptions.Converters.Add(new RawHeroShopVitalityStatsDisplayV2JsonConverter());
            _jsonOptions.Converters.Add(new RawHeroShopWeaponStatsDisplayV2JsonConverter());
            _jsonOptions.Converters.Add(new RawHeroStartingStatsV2JsonConverter());
            _jsonOptions.Converters.Add(new RawHeroStatsDisplayV2JsonConverter());
            _jsonOptions.Converters.Add(new RawHeroStatsUIDisplayV2JsonConverter());
            _jsonOptions.Converters.Add(new RawHeroStatsUIV2JsonConverter());
            _jsonOptions.Converters.Add(new RawHeroV2JsonConverter());
            _jsonOptions.Converters.Add(new RawItemPropertyScaleFunctionSubclassV2JsonConverter());
            _jsonOptions.Converters.Add(new RawItemPropertyScaleFunctionV2JsonConverter());
            _jsonOptions.Converters.Add(new RawItemPropertyV2JsonConverter());
            _jsonOptions.Converters.Add(new RawItemWeaponInfoBulletSpeedCurveSplineV2JsonConverter());
            _jsonOptions.Converters.Add(new RawItemWeaponInfoBulletSpeedCurveV2JsonConverter());
            _jsonOptions.Converters.Add(new RawItemWeaponInfoV2JsonConverter());
            _jsonOptions.Converters.Add(new RawUpgradeTooltipSectionAttributeImportantPropertyV2JsonConverter());
            _jsonOptions.Converters.Add(new RawUpgradeTooltipSectionAttributeV2JsonConverter());
            _jsonOptions.Converters.Add(new RawUpgradeTooltipSectionAttributeV2ImportantPropertyWithIconJsonConverter());
            _jsonOptions.Converters.Add(new RawUpgradeTooltipSectionV2JsonConverter());
            _jsonOptions.Converters.Add(new RawUpgradeV2JsonConverter());
            _jsonOptions.Converters.Add(new RawWeaponInfoHorizontalRecoilV2JsonConverter());
            _jsonOptions.Converters.Add(new RawWeaponInfoV2JsonConverter());
            _jsonOptions.Converters.Add(new RawWeaponInfoVerticalRecoilV2JsonConverter());
            _jsonOptions.Converters.Add(new RawWeaponV2JsonConverter());
            _jsonOptions.Converters.Add(new RejuvParamsJsonConverter());
            _jsonOptions.Converters.Add(new ResponseGetItemV2ItemsIdOrClassNameGetJsonConverter());
            _jsonOptions.Converters.Add(new ResponseGetItemsV2ItemsGetInnerJsonConverter());
            _jsonOptions.Converters.Add(new ResponseGetRawItemsRawItemsGetInnerJsonConverter());
            _jsonOptions.Converters.Add(new ScriptValuesJsonConverter());
            _jsonOptions.Converters.Add(new StandingShotSpreadPenaltyJsonConverter());
            _jsonOptions.Converters.Add(new StatsUsageFlagV2JsonConverter());
            _jsonOptions.Converters.Add(new StatsUsageFlagV2NullableJsonConverter());
            _jsonOptions.Converters.Add(new SteamInfoV1JsonConverter());
            _jsonOptions.Converters.Add(new StreetBrawlJsonConverter());
            _jsonOptions.Converters.Add(new StreetBrawlValueJsonConverter());
            _jsonOptions.Converters.Add(new SubclassBulletResistModifierJsonConverter());
            _jsonOptions.Converters.Add(new SubclassEmpoweredModifierLevelJsonConverter());
            _jsonOptions.Converters.Add(new SubclassIntrinsicModifiersJsonConverter());
            _jsonOptions.Converters.Add(new SubclassModifierDefinitionJsonConverter());
            _jsonOptions.Converters.Add(new SubclassObjectiveHealthGrowthPhaseJsonConverter());
            _jsonOptions.Converters.Add(new SubclassObjectiveRegenJsonConverter());
            _jsonOptions.Converters.Add(new SubclassRangedArmorModifierJsonConverter());
            _jsonOptions.Converters.Add(new SubclassTrooperDamageReductionJsonConverter());
            _jsonOptions.Converters.Add(new ThresholdTypeJsonConverter());
            _jsonOptions.Converters.Add(new ThresholdTypeNullableJsonConverter());
            _jsonOptions.Converters.Add(new TrackedStatNameJsonConverter());
            _jsonOptions.Converters.Add(new TrackedStatNameNullableJsonConverter());
            _jsonOptions.Converters.Add(new TrooperDamageReductionJsonConverter());
            _jsonOptions.Converters.Add(new UpgradeDescriptionV2JsonConverter());
            _jsonOptions.Converters.Add(new UpgradePropertyV2JsonConverter());
            _jsonOptions.Converters.Add(new UpgradeTooltipSectionAttributeV2JsonConverter());
            _jsonOptions.Converters.Add(new UpgradeTooltipSectionAttributeV2ImportantPropertyWithIconJsonConverter());
            _jsonOptions.Converters.Add(new UpgradeTooltipSectionV2JsonConverter());
            _jsonOptions.Converters.Add(new UpgradeV2JsonConverter());
            _jsonOptions.Converters.Add(new UsageFlagsJsonConverter());
            _jsonOptions.Converters.Add(new ValidationErrorJsonConverter());
            _jsonOptions.Converters.Add(new ValueJsonConverter());
            _jsonOptions.Converters.Add(new Value1JsonConverter());
            _jsonOptions.Converters.Add(new WeaponInfoV2JsonConverter());
            _jsonOptions.Converters.Add(new WeaponV2JsonConverter());
            _jsonOptions.Converters.Add(new ZiplanePathV1JsonConverter());
            JsonSerializerOptionsProvider jsonSerializerOptionsProvider = new(_jsonOptions);
            _services.AddSingleton(jsonSerializerOptionsProvider);
            _services.AddSingleton<IApiFactory, ApiFactory>();
            _services.AddSingleton<AccoladesApiEvents>();
            _services.AddSingleton<DefaultApiEvents>();
            _services.AddSingleton<HeroesApiEvents>();
            _services.AddSingleton<ItemsApiEvents>();
            _services.AddSingleton<MiscEntitiesApiEvents>();
            _services.AddSingleton<NPCUnitsApiEvents>();
            _services.AddSingleton<RawApiEvents>();
        }

        /// <summary>
        /// Configures the HttpClients.
        /// </summary>
        /// <param name="client"></param>
        /// <param name="builder"></param>
        /// <returns></returns>
        public HostConfiguration AddApiHttpClients
        (
            Action<HttpClient>? client = null, Action<IHttpClientBuilder>? builder = null)
        {
            if (client == null)
                client = c => c.BaseAddress = new Uri(ClientUtils.BASE_ADDRESS);

            List<IHttpClientBuilder> builders = new List<IHttpClientBuilder>();

            builders.Add(_services.AddHttpClient<IAccoladesApi, AccoladesApi>("AssetsDeadlockApiClient.Api.IAccoladesApi", client));
            builders.Add(_services.AddHttpClient<IDefaultApi, DefaultApi>("AssetsDeadlockApiClient.Api.IDefaultApi", client));
            builders.Add(_services.AddHttpClient<IHeroesApi, HeroesApi>("AssetsDeadlockApiClient.Api.IHeroesApi", client));
            builders.Add(_services.AddHttpClient<IItemsApi, ItemsApi>("AssetsDeadlockApiClient.Api.IItemsApi", client));
            builders.Add(_services.AddHttpClient<IMiscEntitiesApi, MiscEntitiesApi>("AssetsDeadlockApiClient.Api.IMiscEntitiesApi", client));
            builders.Add(_services.AddHttpClient<INPCUnitsApi, NPCUnitsApi>("AssetsDeadlockApiClient.Api.INPCUnitsApi", client));
            builders.Add(_services.AddHttpClient<IRawApi, RawApi>("AssetsDeadlockApiClient.Api.IRawApi", client));
            
            if (builder != null)
                foreach (IHttpClientBuilder instance in builders)
                    builder(instance);

            HttpClientsAdded = true;

            return this;
        }

        /// <summary>
        /// Configures the JsonSerializerSettings
        /// </summary>
        /// <param name="options"></param>
        /// <returns></returns>
        public HostConfiguration ConfigureJsonOptions(Action<JsonSerializerOptions> options)
        {
            options(_jsonOptions);

            return this;
        }

        /// <summary>
        /// Adds tokens to your IServiceCollection
        /// </summary>
        /// <typeparam name="TTokenBase"></typeparam>
        /// <param name="token"></param>
        /// <returns></returns>
        public HostConfiguration AddTokens<TTokenBase>(TTokenBase token) where TTokenBase : TokenBase
        {
            return AddTokens(new TTokenBase[]{ token });
        }

        /// <summary>
        /// Adds tokens to your IServiceCollection
        /// </summary>
        /// <typeparam name="TTokenBase"></typeparam>
        /// <param name="tokens"></param>
        /// <returns></returns>
        public HostConfiguration AddTokens<TTokenBase>(IEnumerable<TTokenBase> tokens) where TTokenBase : TokenBase
        {
            TokenContainer<TTokenBase> container = new TokenContainer<TTokenBase>(tokens);
            _services.AddSingleton(services => container);

            return this;
        }

        /// <summary>
        /// Adds a token provider to your IServiceCollection
        /// </summary>
        /// <typeparam name="TTokenProvider"></typeparam>
        /// <typeparam name="TTokenBase"></typeparam>
        /// <returns></returns>
        public HostConfiguration UseProvider<TTokenProvider, TTokenBase>() 
            where TTokenProvider : TokenProvider<TTokenBase>
            where TTokenBase : TokenBase
        {
            _services.AddSingleton<TTokenProvider>();
            _services.AddSingleton<TokenProvider<TTokenBase>>(services => services.GetRequiredService<TTokenProvider>());

            return this;
        }
    }
}
